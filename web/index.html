<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeoRuta Inmobiliaria</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <style>
    html,body{height:100%;margin:0}
    #map{position:absolute;left:0;top:0;right:300px;bottom:0}
    #controls{position:absolute;right:0;top:0;width:300px;height:100vh;background:#fff;padding:12px;box-sizing:border-box;overflow:auto;border-left:1px solid #ddd}
    h1{font-size:18px;margin:0 0 10px}
    .control-group{margin-bottom:12px}
    select,button{width:100%;padding:8px;box-sizing:border-box}
    button{background:#007bff;color:#fff;border:none;cursor:pointer}
    button:hover{background:#0056b3}
    .small{font-size:13px;color:#444}
    .debug{font-size:13px;color:#666}
  </style>
</head>
<body>
  <div id="map"></div>
  <div id="controls">
    <h1>GeoRuta Inmobiliaria</h1>
    <div class="control-group">
      <label>
        <input type="checkbox" id="filter-by-metro" /> Filtrar por estaciones de metro cercanas
      </label>
      <div style="margin-top:6px">
        <label>
          <input type="checkbox" id="filter-by-health" /> Filtrar por centros de salud cercanos
        </label>
      </div>
      <div style="margin-top:6px">
        <label for="metro-radius" class="small">Radio (metros)</label>
        <input type="number" id="metro-radius" value="500" min="50" max="5000" style="width:100%;padding:6px;box-sizing:border-box" />
      </div>
    </div>

    <div class="control-group">
      <button id="start-point-btn">Usar mi ubicación como partida</button>
    </div>

    <div class="control-group">
      <button id="calculate-route-btn">Calcular Ruta Óptima</button>
    </div>

    <div class="control-group">
      <h3 class="small">Contadores</h3>
      <p class="small">Casas visibles: <b><span id="houses-filtered-count">0</span></b></p>
      <p class="small">Centros de salud: <b><span id="health-count">0</span></b></p>
      <p class="small">Estaciones metro: <b><span id="metro-count">0</span></b></p>
    </div>

    <div class="control-group">
      <h3 class="small">Capas adicionales</h3>
      <label><input type="checkbox" id="show-paraderos-layer" checked /> Mostrar paraderos</label>
      <br/>
      <label><input type="checkbox" id="show-edges-layer" checked /> Mostrar calles (aristas OSM)</label>
      <p class="debug">Paraderos: <span id="debug-paraderos">-</span></p>
      <p class="debug">Aristas: <span id="debug-edges">-</span></p>
    </div>

    <div class="control-group">
      <h3 class="small">Tipo de inmueble</h3>
      <label><input type="checkbox" id="filter-type-casa" checked /> Casa</label>
      <br />
      <label><input type="checkbox" id="filter-type-depto" checked /> Departamento</label>
    </div>

    <div class="control-group">
      <h3 class="small">Operación</h3>
      <label><input type="checkbox" id="filter-op-venta" checked /> Venta</label>
      <br />
      <label><input type="checkbox" id="filter-op-arriendo" checked /> Arriendo</label>
    </div>
    

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // Cache-busted loader for main.js and fetch diagnostic
    (function(){
      const debug = id => document.getElementById(id) || null;
      const dm = debug('debug-mainjs');
      const url = 'main.js?v=' + Date.now();

      // inject script
      const s = document.createElement('script');
      s.src = url; s.async = true;
      s.onload = function(){ if (dm) dm.textContent = 'loaded'; console.log('main.js loaded'); };
      s.onerror = function(e){ if (dm) dm.textContent = 'failed to load'; console.error('main.js load error', e); };
      document.body.appendChild(s);

      // fetch diagnostic (shows size)
      fetch(url).then(r => {
        if (!r.ok) { if (dm) dm.textContent = 'fetch failed '+r.status; return; }
        return r.text().then(t => { if (dm) dm.textContent = 'fetched ('+t.length+' bytes)'; });
      }).catch(e => { if (dm) dm.textContent = 'fetch error'; console.error('fetch main.js', e); });

      window.addEventListener('error', function(evt){
        try{ const el = debug('debug-mainjs'); const msg = evt.message + ' @ ' + evt.filename + ':' + evt.lineno; if (el) el.textContent = 'runtime error: '+msg; console.error('global err', evt.error||msg);}catch(e){}
      });
    })();
  </script>
</body>
</html>