<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>GeoRuta Inmobiliaria - Demo</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
  <link rel="stylesheet" href="custom-styles.css?v=4.0" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <div id="map"></div>
  <!-- Inline map search (bottom-left) - moved to HTML for consistent styling -->
  <!-- centered horizontally at top: use transform to shift left by 50% of its width -->
   <div style="display: flex;
  justify-content: space-between;
  width: 100%;">


     <div id="map-inline-search-wrapper" class="map-inline-search-wrapper" style=" padding: 10px;;position: absolute; left: 40%; top: 18px; transform: translateX(-50%); z-index: 1400;">
       <div class="map-search-inner" style="background: linear-gradient(#06b6d4,#059669); border-radius: 10px; box-shadow: 0 6px 18px rgba(0,0,0,0.12); padding: 8px; display:flex; gap:10px; align-items:center; width: 100%;">
         <select id="map-type-select" aria-label="Tipo" style="padding:6px 8px; border-radius:6px; border:1px solid #e5e7eb; background:#fff; font-weight:600;">
           <option value="any">Tipo de propiedad</option>
           <option value="casa">ğŸ  Casa</option>
           <option value="departamento">ğŸ¢ Depto</option>
         </select>
         <select id="map-op-select" aria-label="OperaciÃ³n" style="padding:6px 8px; border-radius:6px; border:1px solid #e5e7eb; background:#fff; font-weight:600;">
           <option value="any">Venta/Arriendo</option>
           <option value="venta">ğŸ’° Venta</option>
           <option value="arriendo">ğŸ˜ï¸ Arriendo</option>
         </select>
         <input id="map-inline-search-input" type="search" placeholder="Buscar propiedades (tÃ­tulo, direcciÃ³n, comuna)" style="flex:1; padding:8px 10px; border-radius:8px; border:1px solid #e5e7eb; font-size:14px;" />
         <button class="button-buscar" id="map-inline-search-button" style="background:#06b6d4; color:#fff; border:none; padding:8px 12px; border-radius:8px; font-weight:700; cursor:pointer; ">Buscar</button>
       </div>
       <div id="map-inline-search-results" class="map-search-results" style="margin-top:8px; max-height:360px; overflow:auto;">
         <!-- Results populated by main.js -->
       </div>
   </div>
    
    </div>
  </div>
  <div id="controls">
    <div class="header">
      <h1>ğŸ˜ï¸ GeoRuta Inmobiliaria</h1>
      <p class="subtitle">â­ï¸ <i>La <b>resiliencia</b> te guÃ­a hacia tu propiedad perfecta</i></p>
    </div>
    
    <div class="control-group card">
      <h3 class="section-title">ğŸ” BÃºsqueda Inteligente</h3>
      
      <!-- Filtros bÃ¡sicos de tipo y operaciÃ³n -->
      <div style="margin-bottom: 16px;">
        <h4 style="margin: 8px 0 6px; font-size: 13px; font-weight: 600; color: #555;">Tipo de Propiedad</h4>
        <label class="checkbox-label">
          <input type="checkbox" id="search-type-casa" checked />
          <span>ğŸ  Casas</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="search-type-depto" checked />
          <span>ğŸ¢ Departamentos</span>
        </label>
      </div>

      <div style="margin-bottom: 16px;">
        <h4 style="margin: 8px 0 6px; font-size: 13px; font-weight: 600; color: #555;">OperaciÃ³n</h4>
        <label class="checkbox-label">
          <input type="checkbox" id="search-op-venta" checked />
          <span>ğŸ’° Venta</span>
        </label>
        <label class="checkbox-label">
          <input type="checkbox" id="search-op-arriendo" checked />
          <span>ğŸ˜ï¸ Arriendo</span>
        </label>
      </div>

      <!-- Filtros comunes -->
      <div style="margin-bottom: 16px; padding: 12px; background: #f8f9fa; border-radius: 6px;">
        <h4 style="margin: 0 0 12px; font-size: 13px; font-weight: 600; color: #333;">Filtros Generales</h4>
        
        <div class="input-group" style="margin-bottom: 8px;">
          <label for="search-dormitorios-min" class="input-label">ğŸ›ï¸ Dormitorios (mÃ­n.)</label>
          <input type="number" id="search-dormitorios-min" value="0" min="0" max="10" class="input-field" />
        </div>
        
        <div class="input-group" style="margin-bottom: 8px;">
          <label for="search-banos-min" class="input-label">ğŸš¿ BaÃ±os (mÃ­n.)</label>
          <input type="number" id="search-banos-min" value="0" min="0" max="10" class="input-field" />
        </div>

        <div class="input-group" style="margin-bottom: 8px;">
          <label for="search-precio-min" class="input-label">ğŸ’µ Precio mÃ­n. (UF)</label>
          <input type="number" id="search-precio-min" value="0" min="0" step="100" class="input-field" placeholder="0" />
        </div>

        <div class="input-group" style="margin-bottom: 8px;">
          <label for="search-precio-max" class="input-label">ğŸ’µ Precio mÃ¡x. (UF)</label>
          <input type="number" id="search-precio-max" value="" min="0" step="100" class="input-field" placeholder="Sin lÃ­mite" />
        </div>
      </div>

      <!-- Filtros especÃ­ficos para casas -->
      <div id="casa-filters" style="margin-bottom: 16px; padding: 12px; background: #fff3e0; border-radius: 6px; border-left: 3px solid #FFA500;">
        <h4 style="margin: 0 0 12px; font-size: 13px; font-weight: 600; color: #333;">ğŸ  Filtros para Casas</h4>
        
        <div class="input-group" style="margin-bottom: 8px;">
          <label for="search-m2-construido-min" class="input-label">ğŸ“ MÂ² Construidos (mÃ­n.)</label>
          <input type="number" id="search-m2-construido-min" value="0" min="0" step="10" class="input-field" />
        </div>

        <div class="input-group" style="margin-bottom: 8px;">
          <label for="search-m2-terreno-min" class="input-label">ğŸï¸ MÂ² Terreno (mÃ­n.)</label>
          <input type="number" id="search-m2-terreno-min" value="0" min="0" step="10" class="input-field" />
        </div>
      </div>

      <!-- Filtros especÃ­ficos para departamentos -->
      <div id="depto-filters" style="margin-bottom: 16px; padding: 12px; background: #e3f2fd; border-radius: 6px; border-left: 3px solid #2A81CB;">
        <h4 style="margin: 0 0 12px; font-size: 13px; font-weight: 600; color: #333;">ğŸ¢ Filtros para Departamentos</h4>
        
        <div class="input-group" style="margin-bottom: 8px;">
          <label for="search-m2-superficie-min" class="input-label">ğŸ“ MÂ² Superficie (mÃ­n.)</label>
          <input type="number" id="search-m2-superficie-min" value="0" min="0" step="5" class="input-field" />
        </div>

        <label class="checkbox-label">
          <input type="checkbox" id="search-con-terraza" />
          <span>ğŸŒ¿ Con Terraza</span>
        </label>
      </div>

      <div class="button-group">
        <button id="apply-smart-search-btn" class="btn btn-primary">ğŸ” Aplicar BÃºsqueda</button>
        <button id="clear-smart-search-btn" class="btn btn-outline">ğŸ”„ Limpiar Filtros</button>
      </div>
    </div>

    <div class="control-group card">
      <h3 class="section-title">ğŸ“ Filtros de Proximidad</h3>
      <p class="help-text" style="margin-bottom: 12px; font-size: 12px; color: #666;">Filtra propiedades cercanas a servicios especÃ­ficos</p>
      
      <label class="checkbox-label">
        <input type="checkbox" id="filter-by-metro" />
        <span>ğŸš‡ Estaciones de metro</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="filter-by-health" />
        <span>ğŸ¥ Centros de salud</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="filter-by-paraderos" />
        <span>ğŸš Paraderos de bus</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="filter-by-carabineros" />
        <span>ğŸš“ Carabineros</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="filter-by-ferias" />
        <span>ğŸ›’ Ferias libres</span>
      </label>
      <!-- <label class="checkbox-label">
        <input type="checkbox" id="filter-by-bomberos" />
        <span>ğŸš’ Bomberos</span>
      </label> -->
      <label class="checkbox-label">
        <input type="checkbox" id="filter-by-universidades" />
        <span>ğŸ“ Universidades</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="filter-by-colegios" />
        <span>ğŸ« Colegios y Liceos</span>
      </label>
      
      <div class="input-group" style="margin-top: 12px;">
        <label for="proximity-radius" class="input-label">Radio de bÃºsqueda (metros)</label>
        <input type="number" id="proximity-radius" value="500" min="50" max="5000" step="50" class="input-field" />
      </div>
      
      <div class="button-group" style="margin-top: 12px;">
        <button id="apply-proximity-filters-btn" class="btn btn-primary">ğŸ” Aplicar Filtros</button>
        <button id="clear-proximity-filters-btn" class="btn btn-outline">ğŸ”„ Limpiar</button>
      </div>
    </div>

    <div class="control-group card">
      <h3 class="section-title">ğŸ“ Punto de Partida</h3>
      <select id="start-select" class="select-field">
        <option value="user">Selecciona tu punto de partida</option>
      </select>
      <div class="button-group">
        <button id="pick-start-btn" class="btn btn-secondary">ğŸ“ Elegir en mapa</button>
        <button id="start-point-btn" class="btn btn-secondary">ğŸ§­ Mi ubicaciÃ³n</button>
      </div>
    </div>

    <div class="control-group card">
      <h3 class="section-title">ğŸ—“ï¸ Itinerario del DÃ­a</h3>
      <p class="help-text">Selecciona propiedades en el mapa haciendo clic sobre ellas</p>
      <div id="itinerary-list" class="itinerary-container"></div>
      <div class="button-group">
        <button id="clear-selection-btn" class="btn btn-outline">ğŸ—‘ï¸ Limpiar</button>
      </div>
    </div>

    <div class="control-group card">
      <div class="button-group" style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="complete-selection-btn" class="btn btn-outline">â˜‘ï¸ Mostrar selecciÃ³n</button>
        <button id="restore-selection-btn" class="btn btn-outline">â¤´ï¸ Restaurar selecciÃ³n</button>
      </div>
    </div>
    
    <div class="control-group card">
      <div class="button-group" style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="optimize-order-btn" class="btn btn-secondary">ğŸ”€ Optimizar orden</button>
        <button id="generate-recommended-route-btn" class="btn btn-primary">ğŸ¯ Calcular Ruta Ã“ptima</button>
      </div>
    </div>
    
    <!-- <div class="control-group card">
      <h3 class="section-title">ğŸ“‹ Instrucciones recomendadas</h3>
      <div id="recommended-instructions" style="max-height:220px;overflow:auto;padding:8px;background:#fff; border:1px solid #eee;border-radius:6px">
        <em id="instructions-placeholder">Genera una ruta recomendada para ver instrucciones paso a paso.</em>
        <div id="instructions-content"></div>
      </div>
    </div> -->

    <div class="control-group card">
      <h3 class="section-title">ğŸ—ºï¸ Ruta Recomendada</h3>
      
      <!-- Contenedor principal para mostrar la ruta optimizada -->
      <div id="legend-recommended-route" style="display:none;">
        
        <!-- Resumen de la ruta -->
        <div style="margin-bottom: 16px; padding: 16px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
          <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
            <span style="font-size: 32px;">ğŸ¯</span>
            <div style="flex: 1;">
              <h4 style="margin: 0; font-size: 16px; font-weight: 700; color: white;">Tu Ruta Optimizada</h4>
              <p style="margin: 4px 0 0; font-size: 12px; color: rgba(255,255,255,0.9);">Basada en resiliencia y eficiencia</p>
            </div>
          </div>
          
          <!-- EstadÃ­sticas de la ruta -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 12px;">
            <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 10px; border-radius: 8px; text-align: center;">
              <div style="font-size: 20px; margin-bottom: 4px;">â±ï¸</div>
              <div id="route-total-time" style="font-size: 16px; font-weight: 700; color: white;">--</div>
              <div style="font-size: 11px; color: rgba(255,255,255,0.85);">Tiempo</div>
            </div>
            <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 10px; border-radius: 8px; text-align: center;">
              <div style="font-size: 20px; margin-bottom: 4px;">ğŸ“</div>
              <div id="route-total-distance" style="font-size: 16px; font-weight: 700; color: white;">--</div>
              <div style="font-size: 11px; color: rgba(255,255,255,0.85);">Distancia</div>
            </div>
            <div style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); padding: 10px; border-radius: 8px; text-align: center;">
              <div style="font-size: 20px; margin-bottom: 4px;">ğŸ </div>
              <div id="route-total-stops" style="font-size: 16px; font-weight: 700; color: white;">--</div>
              <div style="font-size: 11px; color: rgba(255,255,255,0.85);">Paradas</div>
            </div>
          </div>
        </div>

        <!-- Instrucciones paso a paso -->
        <div id="route-steps-container" style="max-height: 400px; overflow-y: auto; padding: 4px;">
          <!-- Los pasos se llenarÃ¡n dinÃ¡micamente aquÃ­ -->
          <!-- Ejemplo de estructura de paso:
          <div class="route-step">
            <div class="step-header">
              <span class="step-icon">ğŸš¶</span>
              <span class="step-mode">Caminar</span>
              <span class="step-duration">5 min</span>
            </div>
            <div class="step-details">
              <div class="step-distance">450 m</div>
              <div class="step-destination">ğŸ“ Casa en Av. Providencia 1234</div>
              <div class="step-risk">ğŸŸ¢ Riesgo bajo (12%)</div>
            </div>
          </div>
          -->
        </div>

        <!-- Mensaje cuando no hay ruta -->
        <div id="route-empty-message" style="text-align: center; padding: 32px 16px; color: #9CA3AF;">
          <div style="font-size: 48px; margin-bottom: 12px; opacity: 0.5;">ğŸ—ºï¸</div>
          <p style="margin: 0 0 8px; font-size: 14px; font-weight: 600; color: #6B7280;">No hay ruta calculada</p>
          <p style="margin: 0; font-size: 12px; color: #9CA3AF;">Selecciona propiedades y haz clic en "ğŸ¯ Calcular Ruta Ã“ptima"</p>
        </div>

      </div>

      <!-- Mensaje inicial cuando no se ha calculado ruta -->
      <div id="route-placeholder" style="text-align: center; padding: 24px 16px; background: #F9FAFB; border-radius: 8px; border: 2px dashed #D1D5DB;">
        <div style="font-size: 40px; margin-bottom: 10px; opacity: 0.6;">ğŸ§­</div>
        <p style="margin: 0 0 6px; font-size: 13px; font-weight: 600; color: #374151;">Â¿Listo para tu tour inmobiliario?</p>
        <p style="margin: 0; font-size: 12px; color: #6B7280; line-height: 1.5;">
          Selecciona propiedades en el mapa y genera tu ruta optimizada para visitarlas todas de forma eficiente
        </p>
      </div>
    </div>

    <div class="control-group card">
      <h3 class="section-title">ğŸ“Š Cantidad de Elementos Registrados</h3>
      <div class="stats-grid stats-grid-2col">
        <div class="stat-item">
          <span class="stat-label">Propiedades</span>
          <span class="stat-value" id="houses-filtered-count">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Salud</span>
          <span class="stat-value" id="health-count">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Metro</span>
          <span class="stat-value" id="metro-count">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Carabineros</span>
          <span class="stat-value" id="carabineros-count">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Ferias</span>
          <span class="stat-value" id="ferias-count">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Bomberos</span>
          <span class="stat-value" id="bomberos-count">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Universidades</span>
          <span class="stat-value" id="universidades-count">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Colegios</span>
          <span class="stat-value" id="colegios-count">0</span>
        </div>
      </div>
    </div>

    <div class="control-group card">
      <h3 class="section-title">ï¸âš™ï¸ Capas Adicionales</h3>
      <label class="checkbox-label">
        <input type="checkbox" id="show-health-layer" checked />
        <span>ğŸ¥ Centros de salud</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-metro-layer" checked />
        <span>ğŸš‡ Estaciones de metro</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-paraderos-layer" checked />
        <span>ğŸš Paraderos de bus</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-carabineros-layer" checked />
        <span>ğŸš“ Carabineros</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-ferias-layer" checked />
        <span>ğŸ›’ Ferias libres</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-bomberos-layer" checked />
        <span>ğŸš’ Bomberos</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-universidades-layer" checked />
        <span>ğŸ“ Universidades</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-colegios-layer" checked />
        <span>ğŸ« Colegios y Liceos</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-edges-layer" checked />
        <span>ğŸ›£ï¸ Calles (aristas OSM)</span>
      </label>
      
      <hr style="margin: 16px 0; border: none; border-top: 2px solid #E5E7EB;" />
      
      <h4 style="margin: 12px 0 8px; font-size: 13px; font-weight: 600; color: #DC2626;">âš ï¸ Sistema de Amenazas</h4>
      <label class="checkbox-label">
        <input type="checkbox" id="show-active-threats" />
        <span>âš ï¸ Mostrar amenazas activas</span>
      </label>
      <label class="checkbox-label">
        <input type="checkbox" id="show-threat-probabilities" />
        <span>ğŸ“Š Mostrar probabilidades de riesgo</span>
      </label>
      <p class="help-text" style="font-size: 11px; color: #6B7280; margin-top: 8px;">
        ğŸ’¡ Las amenazas activas se basan en la Ãºltima simulaciÃ³n Monte Carlo
      </p>
      
      <div class="debug-info" style="display: none;">
        <p class="debug">Salud: <span id="debug-health">-</span></p>
        <p class="debug">Metro: <span id="debug-metro">-</span></p>
        <p class="debug">Paraderos: <span id="debug-paraderos">-</span></p>
        <p class="debug">Carabineros: <span id="debug-carabineros">-</span></p>
        <p class="debug">Ferias: <span id="debug-ferias">-</span></p>
        <p class="debug">Bomberos: <span id="debug-bomberos">-</span></p>
        <p class="debug">Universidades: <span id="debug-universidades">-</span></p>
        <p class="debug">Colegios: <span id="debug-colegios">-</span></p>
        <p class="debug">Aristas: <span id="debug-edges">-</span></p>
        <p class="debug">Ruta OSM: <span id="debug-route">-</span></p>
      </div>
    </div>

    <div class="control-group card">
      <h3 class="section-title">ğŸ‘¥ Autores del Proyecto</h3>
      <div style="display: flex; flex-direction: column; gap: 12px; margin-top: 12px;">
        
        <a href="https://github.com/fase99" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;">
          <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: linear-gradient(135deg, #f6f8fb 0%, #e9ecf1 100%); border-radius: 12px; transition: all 0.3s ease; cursor: pointer; border: 2px solid transparent;">
            <img 
              src="https://github.com/fase99.png" 
              alt="fase99" 
              style="width: 48px; height: 48px; border-radius: 50%; border: 2px solid #7C3AED; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);"
              onerror="this.src='https://via.placeholder.com/48/7C3AED/FFFFFF?text=F'"
            />
            <div style="flex: 1;">
              <div style="font-weight: 600; font-size: 14px; color: #374151; margin-bottom: 2px;">fase99</div>
              <div style="font-size: 12px; color: #6B7280; display: flex; align-items: center; gap: 4px;">
                <svg style="width: 14px; height: 14px; fill: currentColor;" viewBox="0 0 16 16">
                  <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                GitHub Profile
              </div>
            </div>
            <svg style="width: 20px; height: 20px; fill: #9CA3AF;" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
        </a>

        <a href="https://github.com/tiagomedi" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;">
          <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: linear-gradient(135deg, #f6f8fb 0%, #e9ecf1 100%); border-radius: 12px; transition: all 0.3s ease; cursor: pointer; border: 2px solid transparent;">
            <img 
              src="https://github.com/tiagomedi.png" 
              alt="tiagomedi" 
              style="width: 48px; height: 48px; border-radius: 50%; border: 2px solid #7C3AED; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);"
              onerror="this.src='https://via.placeholder.com/48/7C3AED/FFFFFF?text=F'"
            />
            <div style="flex: 1;">
              <div style="font-weight: 600; font-size: 14px; color: #374151; margin-bottom: 2px;">tiagomedi</div>
              <div style="font-size: 12px; color: #6B7280; display: flex; align-items: center; gap: 4px;">
                <svg style="width: 14px; height: 14px; fill: currentColor;" viewBox="0 0 16 16">
                  <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                GitHub Profile
              </div>
            </div>
            <svg style="width: 20px; height: 20px; fill: #9CA3AF;" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
        </a>

        <a href="https://github.com/Pipeemendez" target="_blank" rel="noopener noreferrer" style="text-decoration: none; color: inherit;">
          <div style="display: flex; align-items: center; gap: 12px; padding: 12px; background: linear-gradient(135deg, #f6f8fb 0%, #e9ecf1 100%); border-radius: 12px; transition: all 0.3s ease; cursor: pointer; border: 2px solid transparent;">
            <img 
              src="https://github.com/Pipeemendez.png" 
              alt="Pipeemendez" 
              style="width: 48px; height: 48px; border-radius: 50%; border: 2px solid #7C3AED; box-shadow: 0 2px 8px rgba(124, 58, 237, 0.3);"
              onerror="this.src='https://via.placeholder.com/48/7C3AED/FFFFFF?text=F'"
            />
            <div style="flex: 1;">
              <div style="font-weight: 600; font-size: 14px; color: #374151; margin-bottom: 2px;">Pipeemendez</div>
              <div style="font-size: 12px; color: #6B7280; display: flex; align-items: center; gap: 4px;">
                <svg style="width: 14px; height: 14px; fill: currentColor;" viewBox="0 0 16 16">
                  <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                </svg>
                GitHub Profile
              </div>
            </div>
            <svg style="width: 20px; height: 20px; fill: #9CA3AF;" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
            </svg>
          </div>
        </a>

      </div>
      
      <p style="margin-top: 12px; text-align: center; font-size: 11px; color: #9CA3AF; font-style: italic;">
        Haz clic para visitar el perfil de GitHub
      </p>
    </div>

    <div class="control-group card">
      <p style="margin-top: 12px; text-align: center; font-size: 11px; color: #9CA3AF;">
        Â© 2025 GeoRuta Inmobiliaria. All rights reserved FreeTomorrow.
      </p>
    </div>
  </div>

  <!-- BotÃ³n flotante para simbologÃ­a -->
  <button id="legend-button" class="floating-legend-btn" title="Ver simbologÃ­a de marcadores">
    ğŸ—ºï¸
  </button>
  <!-- BotÃ³n flotante para informaciÃ³n de la pagina, como utilizarla -->
  <button 
    id="info-button" 
    class="floating-info-btn" 
    title="InformaciÃ³n sobre GeoRuta Inmobiliaria"
    onclick="console.log('Click inline detectado'); document.getElementById('info-modal').style.display='flex'; document.getElementById('info-modal').classList.add('show');">
    â„¹ï¸
  </button>


  <!-- Modal de simbologÃ­a -->
  <div id="legend-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: #7C3AED;">ğŸ—ºï¸ SimbologÃ­a - GeoRuta Inmobiliaria</h3>
        <button id="close-modal" class="close-modal">&times;</button>
      </div>
      
      <div class="modal-body">
        <p class="help-text" style="margin-bottom: 16px; font-size: 13px; color: #6B7280;">Los marcadores estÃ¡n divididos en dos colores para identificar el tipo de propiedad y operaciÃ³n</p>
        
        <div style="margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px; font-size: 14px; font-weight: 600; color: #374151; border-bottom: 2px solid #E5E7EB; padding-bottom: 6px;">
            Lado Izquierdo = Tipo de Propiedad
          </h4>
          <div class="legend-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 28px; height: 28px; background: #FFA500; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
            <span style="font-size: 14px; font-weight: 500;">ğŸ  Casa (Orange/Naranja)</span>
          </div>
          <div class="legend-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 28px; height: 28px; background: #2A81CB; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
            <span style="font-size: 14px; font-weight: 500;">ğŸ¢ Departamento (Blue/Azul)</span>
          </div>
        </div>

        <div style="margin-bottom: 20px;">
          <h4 style="margin: 0 0 10px; font-size: 14px; font-weight: 600; color: #374151; border-bottom: 2px solid #E5E7EB; padding-bottom: 6px;">
            Lado Derecho = Tipo de OperaciÃ³n
          </h4>
          <div class="legend-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 28px; height: 28px; background: #DC143C; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
            <span style="font-size: 14px; font-weight: 500;">ğŸ’° Venta (Red/Rojo)</span>
          </div>
          <div class="legend-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 28px; height: 28px; background: #FFD700; border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
            <span style="font-size: 14px; font-weight: 500;">ğŸ˜ï¸ Arriendo (Gold/Dorado)</span>
          </div>
        </div>

        <div style="margin-bottom: 20px; padding: 16px; background: #F9FAFB; border-radius: 8px; border: 1px solid #E5E7EB;">
          <h4 style="margin: 0 0 12px; font-size: 14px; font-weight: 600; color: #374151;">
            ğŸ“Œ Ejemplos de Combinaciones:
          </h4>
          <div class="legend-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(90deg, #FFA500 50%, #DC143C 50%); border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
            <span style="font-size: 14px;">ğŸ  + ğŸ’° = Casa en Venta</span>
          </div>
          <div class="legend-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(90deg, #FFA500 50%, #FFD700 50%); border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
            <span style="font-size: 14px;">ğŸ  + ğŸ˜ï¸ = Casa en Arriendo</span>
          </div>
          <div class="legend-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(90deg, #2A81CB 50%, #DC143C 50%); border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
            <span style="font-size: 14px;">ğŸ¢ + ğŸ’° = Depto en Venta</span>
          </div>
          <div class="legend-item" style="margin-bottom: 10px; display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(90deg, #2A81CB 50%, #FFD700 50%); border-radius: 50%; border: 3px solid white; box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
            <span style="font-size: 14px;">ğŸ¢ + ğŸ˜ï¸ = Depto en Arriendo</span>
          </div>
        </div>

        <div style="padding: 16px; background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%); border-radius: 8px; border: 2px solid #28a745;">
          <div class="legend-item" style="margin-bottom: 0; display: flex; align-items: center; gap: 12px;">
            <div style="width: 32px; height: 32px; background: linear-gradient(90deg, #FFA500 50%, #DC143C 50%); border-radius: 50%; border: 4px solid #28a745; box-shadow: 0 0 12px rgba(40,167,69,0.6); flex-shrink: 0;"></div>
            <span style="font-size: 14px; font-weight: 600; color: #28a745;">âœ“ Propiedad Seleccionada (borde verde brillante)</span>
          </div>
        </div>

        <!-- Capas Adicionales -->
        <div style="margin-top: 24px; padding-top: 20px; border-top: 3px solid #7C3AED;">
          <h4 style="margin: 0 0 16px; font-size: 16px; font-weight: 700; color: #7C3AED;">
            ğŸ—ºï¸ Capas Adicionales del Mapa
          </h4>
          
          <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px;">
            <!-- Paraderos -->
            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 28px; background: #28a745; clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
              <span style="font-size: 13px;">ğŸš Paraderos (Verde)</span>
            </div>

            <!-- Metro -->
            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 28px; background: #DC143C; clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
              <span style="font-size: 13px;">ğŸš‡ Metro (Rojo)</span>
            </div>

            <!-- Salud -->
            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 28px; background: #2196F3; clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
              <span style="font-size: 13px;">ğŸ¥ Salud (Azul)</span>
            </div>

            <!-- Carabineros -->
            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 28px; background: #000000; clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
              <span style="font-size: 13px;">ğŸ‘® Carabineros (Negro)</span>
            </div>

            <!-- Ferias -->
            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 28px; background: #7F8C8D; clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
              <span style="font-size: 13px;">ğŸ¥¬ Ferias (Gris)</span>
            </div>

            <!-- Bomberos -->
            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 28px; background: #FFD700; clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
              <span style="font-size: 13px;">ğŸš’ Bomberos (Dorado)</span>
            </div>

            <!-- Universidades -->
            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 28px; background: #FF6F00; clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
              <span style="font-size: 13px;">ğŸ“ Universidades (Naranja)</span>
            </div>

            <!-- Colegios -->
            <div class="legend-item" style="display: flex; align-items: center; gap: 8px;">
              <div style="width: 20px; height: 28px; background: #FFEB3B; clip-path: polygon(50% 0%, 100% 35%, 100% 100%, 0% 100%, 0% 35%); box-shadow: 0 2px 4px rgba(0,0,0,0.3); flex-shrink: 0;"></div>
              <span style="font-size: 13px;">ğŸ« Colegios (Amarillo)</span>
            </div>
          </div>

          <p style="margin-top: 12px; font-size: 12px; color: #6B7280; font-style: italic; text-align: center;">
            ğŸ’¡ Activa/desactiva estas capas desde el panel lateral "ğŸ—ºï¸ Capas Adicionales"
          </p>
        </div>

        <div style="margin-top: 24px; padding-top: 20px; border-top: 3px solid #7C3AED;">
        <h4 style="margin: 0 0 16px; font-size: 16px; font-weight: 700; color: #7C3AED;">
          ğŸš¦ SimbologÃ­a Promedio de Trafico Vehicular
        </h4>
        <!-- <p style="margin-bottom: 16px; font-size: 13px; color: #6B7280; line-height: 1.6;">
            Las rutas calculadas se visualizan en el mapa con diferentes colores segÃºn el nivel de riesgo y el modo de transporte:
          </p> -->

          <!-- Niveles de Riesgo en Rutas -->
          <div style="margin-bottom: 20px; padding: 16px; background: #F9FAFB; border-radius: 8px; border: 1px solid #E5E7EB;">
            <h5 style="margin: 0 0 12px; font-size: 14px; font-weight: 600; color: #374151;">
              ğŸ¨ Colores por Nivel de TrÃ¡fico Promedio
            </h5>
            
            <p style="margin: 0 0 12px; font-size: 12px; color: #6B7280; line-height: 1.5;">
              Los colores indican el nivel de trÃ¡fico promedio histÃ³rico de cada zona:
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 10px;">
              <div class="legend-item" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 50px; height: 6px; background: #10B981; border-radius: 3px; box-shadow: 0 2px 4px rgba(16,185,129,0.3); flex-shrink: 0;"></div>
                <div style="flex: 1;">
                  <span style="font-size: 14px; font-weight: 600; color: #059669;">ğŸŸ¢ TrÃ¡fico Bajo (0-25%)</span>
                  <p style="margin: 2px 0 0; font-size: 11px; color: #6B7280;">Zona con flujo vehicular fluido</p>
                </div>
              </div>
              
              <div class="legend-item" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 50px; height: 6px; background: #F59E0B; border-radius: 3px; box-shadow: 0 2px 4px rgba(245,158,11,0.3); flex-shrink: 0;"></div>
                <div style="flex: 1;">
                  <span style="font-size: 14px; font-weight: 600; color: #D97706;">ğŸŸ¡ TrÃ¡fico Medio (25-50%)</span>
                  <p style="margin: 2px 0 0; font-size: 11px; color: #6B7280;">CongestiÃ³n moderada en horarios peak</p>
                </div>
              </div>
              
              <div class="legend-item" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 50px; height: 6px; background: #EF4444; border-radius: 3px; box-shadow: 0 2px 4px rgba(239,68,68,0.3); flex-shrink: 0;"></div>
                <div style="flex: 1;">
                  <span style="font-size: 14px; font-weight: 600; color: #DC2626;">ğŸ”´ TrÃ¡fico Alto (>50%)</span>
                  <p style="margin: 2px 0 0; font-size: 11px; color: #6B7280;">Alta congestiÃ³n frecuente</p>
                </div>
              </div>
            </div>
          </div>


        <!-- SimbologÃ­a de Rutas -->
        <div style="margin-top: 24px; padding-top: 20px; border-top: 3px solid #7C3AED;">
          <h4 style="margin: 0 0 16px; font-size: 16px; font-weight: 700; color: #7C3AED;">
            ğŸ—ºï¸ SimbologÃ­a de Rutas Optimizadas
          </h4>

          <!-- Modos de Transporte -->
          <div style="margin-bottom: 16px; padding: 16px; background: #EFF6FF; border-radius: 8px; border: 1px solid #DBEAFE;">
            <h5 style="margin: 0 0 12px; font-size: 14px; font-weight: 600; color: #1E40AF;">
              ğŸš¶ SimbologÃ­a Modos de Transporte
            </h5>
            
            <p style="margin: 0 0 12px; font-size: 12px; color: #6B7280; line-height: 1.5;">
              Las lÃ­neas de ruta muestran el modo de transporte recomendado:
            </p>
            
            <div style="display: flex; flex-direction: column; gap: 12px;">
              <!-- Caminar - LÃ­nea segmentada azul -->
              <div class="legend-item" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 60px; height: 8px; background: repeating-linear-gradient(90deg, #3B82F6 0px, #3B82F6 8px, transparent 8px, transparent 16px); border-radius: 2px; box-shadow: 0 2px 4px rgba(59,130,246,0.3); flex-shrink: 0; position: relative;">
                  <div style="position: absolute; left: 0; top: 50%; transform: translateY(-50%); font-size: 16px;">ğŸš¶</div>
                  <div style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); font-size: 16px;">ğŸš¶</div>
                </div>
                <div style="flex: 1; margin-left: 8px;">
                  <span style="font-size: 14px; font-weight: 600; color: #1E40AF;">Caminar - LÃ­nea segmentada azul</span>
                  <p style="margin: 2px 0 0; font-size: 11px; color: #6B7280;">Tramos cortos a pie entre ubicaciones</p>
                </div>
              </div>
              
              <!-- Transporte PÃºblico - LÃ­nea rojo anaranjado -->
              <div class="legend-item" style="display: flex; align-items: center; gap: 12px;">
                <div style="width: 60px; height: 8px; background: linear-gradient(90deg, #EF4444 0%, #F97316 100%); border-radius: 2px; box-shadow: 0 2px 4px rgba(239,68,68,0.3); flex-shrink: 0; position: relative;">
                  <div style="position: absolute; left: 0; top: 50%; transform: translateY(-50%); font-size: 16px;">ğŸšŒ</div>
                  <div style="position: absolute; right: 0; top: 50%; transform: translateY(-50%); font-size: 16px;">ğŸšŒ</div>
                </div>
                <div style="flex: 1; margin-left: 8px;">
                  <span style="font-size: 14px; font-weight: 600; color: #DC2626;">Micro - LÃ­nea rojo anaranjado</span>
                  <p style="margin: 2px 0 0; font-size: 11px; color: #6B7280;">Usar paradero cercano para distancias largas</p>
                </div>
              </div>
            </div>
          </div>

          <!-- InformaciÃ³n adicional -->
          <div style="padding: 12px; background: linear-gradient(135deg, #F0FDF4 0%, #DCFCE7 100%); border-radius: 8px; border-left: 4px solid #22C55E;">
            <p style="margin: 0; font-size: 12px; color: #166534; line-height: 1.6;">
              <strong>ğŸ’¡ Tip:</strong> El sistema calcula automÃ¡ticamente la mejor ruta considerando distancias, tiempos de viaje, disponibilidad de transporte pÃºblico y niveles de trÃ¡fico histÃ³rico en cada tramo. Los colores te ayudan a identificar rÃ¡pidamente las zonas con menor congestiÃ³n vehicular en tu recorrido.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

  <!-- Modal de informaciÃ³n -->
  <div id="info-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 style="margin: 0; font-size: 18px; font-weight: 700; color: #3B82F6;">â„¹ï¸ GuÃ­a de Uso - GeoRuta Inmobiliaria</h3>
        <button id="close-info-modal" class="close-modal">&times;</button>
      </div>
      
      <div class="modal-body">
        <p class="help-text" style="margin-bottom: 20px; font-size: 14px; color: #374151;">
          Bienvenido a <strong>GeoRuta Inmobiliaria</strong>, tu herramienta para encontrar y planificar visitas a propiedades en Providencia con rutas optimizadas basadas en resiliencia.
        </p>

        <!-- Paso 1 -->
        <div style="margin-bottom: 20px; padding: 16px; background: #F0F9FF; border-radius: 8px; border-left: 4px solid #3B82F6;">
          <h4 style="margin: 0 0 10px; font-size: 15px; font-weight: 600; color: #1E40AF;">
            ğŸ“ Paso 1: Filtra Propiedades
          </h4>
          <p style="margin: 0; font-size: 13px; color: #374151; line-height: 1.6;">
            Usa el panel <strong>"ğŸ” BÃºsqueda Inteligente"</strong> para filtrar por tipo (casa/depto), operaciÃ³n (venta/arriendo), dormitorios, baÃ±os, precio y mÃ¡s. Haz clic en <strong>"ğŸ” Aplicar BÃºsqueda"</strong> para ver los resultados en el mapa.
          </p>
        </div>

        <!-- Paso 2 -->
        <div style="margin-bottom: 20px; padding: 16px; background: #F5F3FF; border-radius: 8px; border-left: 4px solid #7C3AED;">
          <h4 style="margin: 0 0 10px; font-size: 15px; font-weight: 600; color: #5B21B6;">
            ğŸ“ Paso 2: Define tu Punto de Partida
          </h4>
          <p style="margin: 0; font-size: 13px; color: #374151; line-height: 1.6;">
            En el panel <strong>"ğŸ“ Punto de Partida"</strong>, elige tu ubicaciÃ³n actual (ğŸ§­ Mi ubicaciÃ³n) o selecciona un punto en el mapa (ğŸ“ Elegir en mapa). Este serÃ¡ el inicio de tu ruta.
          </p>
        </div>

        <!-- Paso 3 -->
        <div style="margin-bottom: 20px; padding: 16px; background: #FEF3C7; border-radius: 8px; border-left: 4px solid #F59E0B;">
          <h4 style="margin: 0 0 10px; font-size: 15px; font-weight: 600; color: #92400E;">
            ğŸ  Paso 3: Selecciona Propiedades
          </h4>
          <p style="margin: 0; font-size: 13px; color: #374151; line-height: 1.6;">
            Haz clic en los marcadores de propiedades en el mapa para aÃ±adirlas a tu itinerario. Las verÃ¡s aparecer en <strong>"ğŸ—“ï¸ Itinerario del DÃ­a"</strong>. Los marcadores seleccionados tendrÃ¡n un borde verde brillante.
          </p>
        </div>

        <!-- Paso 4 -->
        <div style="margin-bottom: 20px; padding: 16px; background: #DCFCE7; border-radius: 8px; border-left: 4px solid #22C55E;">
          <h4 style="margin: 0 0 10px; font-size: 15px; font-weight: 600; color: #15803D;">
            ğŸ¯ Paso 4: Calcula la Ruta Ã“ptima
          </h4>
          <p style="margin: 0; font-size: 13px; color: #374151; line-height: 1.6;">
            Una vez seleccionadas tus propiedades, haz clic en <strong>"ğŸ¯ Calcular Ruta Ã“ptima"</strong>. El sistema generarÃ¡ una ruta optimizada que:
          </p>
          <ul style="margin: 8px 0 0 20px; font-size: 13px; color: #374151; line-height: 1.6;">
            <li>Minimiza distancias y tiempo de viaje</li>
            <li>Considera paraderos de transporte pÃºblico</li>
            <li>Calcula probabilidades de riesgo en cada tramo</li>
            <li>Te sugiere si caminar o usar transporte pÃºblico</li>
          </ul>
        </div>

        <!-- Paso 5 -->
        <div style="margin-bottom: 20px; padding: 16px; background: #FEE2E2; border-radius: 8px; border-left: 4px solid #EF4444;">
          <h4 style="margin: 0 0 10px; font-size: 15px; font-weight: 600; color: #991B1B;">
            ï¿½ï¸ Paso 5: Revisa tu Ruta Recomendada
          </h4>
          <p style="margin: 0; font-size: 13px; color: #374151; line-height: 1.6;">
            Una vez calculada la ruta, el panel <strong>"ğŸ—ºï¸ Ruta Recomendada"</strong> te mostrarÃ¡:
          </p>
          <ul style="margin: 8px 0 0 20px; font-size: 13px; color: #374151; line-height: 1.6;">
            <li><strong>Resumen general:</strong> Tiempo total estimado â±ï¸, distancia total ğŸ“ y nÃºmero de paradas ğŸ </li>
            <li><strong>Instrucciones paso a paso:</strong> Cada tramo con su modo de transporte (ğŸš¶ caminar / ğŸšŒ bus)</li>
            <li><strong>Nivel de riesgo:</strong> Cada paso muestra su nivel de seguridad (ğŸŸ¢ bajo / ğŸŸ¡ medio / ğŸ”´ alto)</li>
            <li><strong>Detalles de propiedades:</strong> InformaciÃ³n de cada inmueble (precio, dormitorios, baÃ±os)</li>
            <li><strong>VisualizaciÃ³n en mapa:</strong> La ruta se dibuja automÃ¡ticamente con colores segÃºn el riesgo</li>
          </ul>
        </div>

        <!-- Consejos adicionales -->
        <div style="padding: 16px; background: #F9FAFB; border-radius: 8px; border: 2px dashed #D1D5DB;">
          <h4 style="margin: 0 0 10px; font-size: 15px; font-weight: 600; color: #374151;">
            ğŸ’¡ Consejos Ãštiles
          </h4>
          <ul style="margin: 0; padding-left: 20px; font-size: 13px; color: #6B7280; line-height: 1.8;">
            <li>Usa <strong>"ğŸ”€ Optimizar orden"</strong> antes de calcular la ruta para obtener el mejor recorrido</li>
            <li>El panel <strong>"ğŸ—ºï¸ Ruta Recomendada"</strong> se actualiza cada vez que generas una nueva ruta</li>
            <li>Los pasos de la ruta incluyen distancias precisas y tiempos estimados de traslado</li>
            <li>Usa <strong>"â˜‘ï¸ Mostrar selecciÃ³n"</strong> para ocultar propiedades no seleccionadas</li>
            <li>Haz clic en <strong>"ğŸ“£"</strong> para ver la simbologÃ­a de los marcadores</li>
            <li>Activa/desactiva capas desde <strong>"ğŸ—ºï¸ Capas Adicionales"</strong></li>
            <li>Filtra por proximidad a metro/salud/colegios/paraderos/etc en <strong>"ğŸ“ Filtros de Proximidad"</strong></li>
            <li>Los tramos de ruta se colorean segÃºn su nivel de riesgo (verde=seguro, rojo=riesgoso)</li>
          </ul>
        </div>

        <p style="margin-top: 20px; text-align: center; font-size: 12px; color: #9CA3AF; font-style: italic;">
          â­ La resiliencia te guÃ­a hacia tu propiedad perfecta
        </p>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // Cache-busted loader for main.js and fetch diagnostic
    (function(){
      const debug = id => document.getElementById(id) || null;
      const dm = debug('debug-mainjs');
      const url = 'main.js?v=' + Date.now();

      // inject script
      const s = document.createElement('script');
      s.src = url; s.async = true;
      s.onload = function(){ if (dm) dm.textContent = 'loaded'; console.log('main.js loaded'); };
      s.onerror = function(e){ if (dm) dm.textContent = 'failed to load'; console.error('main.js load error', e); };
      document.body.appendChild(s);

      // fetch diagnostic (shows size)
      fetch(url).then(r => {
        if (!r.ok) { if (dm) dm.textContent = 'fetch failed '+r.status; return; }
        return r.text().then(t => { if (dm) dm.textContent = 'fetched ('+t.length+' bytes)'; });
      }).catch(e => { if (dm) dm.textContent = 'fetch error'; console.error('fetch main.js', e); });

      window.addEventListener('error', function(evt){
        try{ const el = debug('debug-mainjs'); const msg = evt.message + ' @ ' + evt.filename + ':' + evt.lineno; if (el) el.textContent = 'runtime error: '+msg; console.error('global err', evt.error||msg);}catch(e){}
      });
    })();
  </script>
  
  <script>
    // Debug: Verificar que el botÃ³n de info existe y estÃ¡ visible
    window.addEventListener('DOMContentLoaded', function() {
      const infoBtn = document.getElementById('info-button');
      const legendBtn = document.getElementById('legend-button');
      
      console.log('=== DEBUG BOTONES ===');
      console.log('Legend button:', legendBtn);
      console.log('Info button:', infoBtn);
      
      if (infoBtn) {
        const styles = window.getComputedStyle(infoBtn);
        console.log('Info button display:', styles.display);
        console.log('Info button position:', styles.position);
        console.log('Info button top:', styles.top);
        console.log('Info button right:', styles.right);
        console.log('Info button z-index:', styles.zIndex);
        console.log('Info button visibility:', styles.visibility);
        console.log('Info button opacity:', styles.opacity);
      } else {
        console.error('âš ï¸ Info button NO encontrado!');
      }
      
      if (legendBtn) {
        const styles = window.getComputedStyle(legendBtn);
        console.log('Legend button display:', styles.display);
        console.log('Legend button position:', styles.position);
        console.log('Legend button top:', styles.top);
        console.log('Legend button right:', styles.right);
      } else {
        console.error('âš ï¸ Legend button NO encontrado!');
      }
    });
  </script>
</body>
</html>